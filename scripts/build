#!/usr/bin/env bash

PROJECT_NAME="libzeropool_wasm"

wasm-pack build
# Optimize the binary, since wasm-pack refuses to see wasm-opt
wasm-opt -o pkg/wasm-opt.wasm -O3 pkg/${PROJECT_NAME}_bg.wasm && mv pkg/wasm-opt.wasm pkg/${PROJECT_NAME}_bg.wasm
# Patch typings for async methods
sed -i '' -E 's/(createTx\(.*\)):.*$/\1: Promise<TransactionData>;/g' pkg/${PROJECT_NAME}.d.ts
